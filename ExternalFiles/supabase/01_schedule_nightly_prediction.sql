-- =============================================================
-- Nightly AI Prediction Engine — Invocation Guide
-- =============================================================
--
-- The Edge Function "nightly-prediction" runs the AI prediction
-- engine (EMA recalculation + auto-add logic).
--
-- ⚠️  pg_cron is NOT available on Supabase Free plan.
--     Use one of the alternatives below to trigger the function.
--
-- =============================================================
-- OPTION A: GitHub Actions Cron (recommended for Free plan)
-- =============================================================
-- Create .github/workflows/nightly-prediction.yml in your repo:
--
--   name: Nightly Prediction
--   on:
--     schedule:
--       - cron: '0 2 * * *'    # daily at 02:00 UTC
--     workflow_dispatch:         # allow manual trigger
--   jobs:
--     trigger:
--       runs-on: ubuntu-latest
--       steps:
--         - name: Call Edge Function
--           run: |
--             curl -X POST \
--               "https://aynippaxcwmqufrnthti.supabase.co/functions/v1/nightly-prediction" \
--               -H "Content-Type: application/json" \
--               -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
--               -d '{}'
--
-- Then add CRON_SECRET as a GitHub repository secret.
--
-- =============================================================
-- OPTION B: Manual trigger via curl (for testing)
-- =============================================================
-- Run this from your terminal:
--
--   curl -X POST \
--     "https://aynippaxcwmqufrnthti.supabase.co/functions/v1/nightly-prediction" \
--     -H "Content-Type: application/json" \
--     -H "Authorization: Bearer <YOUR_CRON_SECRET>" \
--     -d '{}'
--
-- =============================================================
-- OPTION C: pg_cron (requires Supabase Pro plan)
-- =============================================================
-- If you upgrade to Pro, enable pg_cron from Dashboard → Database
-- → Extensions, then run:
--
-- CREATE EXTENSION IF NOT EXISTS "pg_cron";
-- CREATE EXTENSION IF NOT EXISTS "pg_net";
--
-- SELECT cron.schedule(
--   'nightly-prediction-engine',
--   '0 2 * * *',
--   $$
--   SELECT
--     net.http_post(
--       url := 'https://aynippaxcwmqufrnthti.supabase.co/functions/v1/nightly-prediction',
--       headers := jsonb_build_object(
--         'Content-Type', 'application/json',
--         'Authorization', 'Bearer ' || current_setting('app.settings.cron_secret', true)
--       ),
--       body := '{}'::jsonb
--     ) AS request_id;
--   $$
-- );
--
-- Verify with:
--   SELECT * FROM cron.job WHERE jobname = 'nightly-prediction-engine';
--
-- Unschedule with:
--   SELECT cron.unschedule('nightly-prediction-engine');
-- =============================================================

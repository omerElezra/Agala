/**
 * Auto-detect product category from Hebrew product name.
 * Uses keyword mapping + partial matching.
 */

type CategoryMap = Record<string, string[]>;

// Hebrew keywords → category
const CATEGORY_KEYWORDS: CategoryMap = {
  'פירות וירקות': [
    'תפוח', 'בננה', 'תפוז', 'לימון', 'אבוקדו', 'מנגו', 'ענבים', 'אפרסק',
    'שזיף', 'אגס', 'קיווי', 'רימון', 'אננס', 'דובדבן', 'תות', 'אבטיח',
    'מלון', 'פומלה', 'קלמנטינה', 'גויאבה', 'פסיפלורה',
    'עגבניה', 'עגבניות', 'מלפפון', 'פלפל', 'בצל', 'שום', 'גזר', 'חסה',
    'כרוב', 'ברוקולי', 'כרובית', 'חציל', 'קישוא', 'קישואים',
    'בטטה', 'תפוח אדמה', 'תפו"א', 'סלרי', 'כוסברה', 'פטרוזיליה',
    'נענע', 'שמיר', 'רוקולה', 'תרד', 'פטריות', 'זיתים', 'אבוקאדו',
    'דלעת', 'צנונית', 'לפת', 'ירקות', 'פירות', 'סלט',
  ],
  'מוצרי חלב': [
    'חלב', 'גבינה', 'יוגורט', 'קוטג', 'שמנת', 'קפיר', 'לבן', 'מעדן',
    'גבינה צהובה', 'גבינה לבנה', 'שמנת חמוצה', 'מוצרלה', 'פרמזן',
    'קממבר', 'ברי', 'פטה', 'בולגרית', 'שוקו', 'דנונה', 'אקטיביה',
    'מילקי',
  ],
  'בשר ועוף': [
    'עוף', 'חזה עוף', 'שניצל', 'כרעיים', 'בשר', 'סטייק', 'קבב', 'המבורגר',
    'נקניק', 'נקניקיות', 'בקר', 'כבש', 'טלה', 'פרגית', 'כנפיים',
    'שוק עוף', 'טחון', 'צלעות', 'אנטריקוט', 'סינטה', 'פילה',
  ],
  'דגים ופירות ים': [
    'דג', 'סלמון', 'טונה', 'אמנון', 'דניס', 'לוקוס', 'נסיכה', 'פילה דג',
    'שרימפס', 'קלמרי', 'סרדין', 'מקרל', 'בקלה', 'ברמונדי',
  ],
  'לחם ומאפים': [
    'לחם', 'חלה', 'פיתה', 'טורטייה', 'לחמנייה', 'באגט', 'לאפה',
    'קרואסון', 'מאפה', 'בורקס', 'עוגייה', 'עוגיות', 'ביסקוויט',
    'קרקר', 'פריכיות', 'פת',
  ],
  'ביצים': [
    'ביצים', 'ביצה',
  ],
  'משקאות': [
    'מים', 'מיץ', 'קולה', 'סודה', 'בירה', 'יין', 'וודקה', 'ויסקי',
    'ג\'ין', 'טוניק', 'אנרגיה', 'לימונדה', 'קפה', 'תה', 'נס קפה',
    'אספרסו', 'קפוצ\'ינו', 'שוקו', 'קקאו',
  ],
  'חטיפים ומתוקים': [
    'שוקולד', 'במבה', 'ביסלי', 'חטיף', 'וופל', 'סוכריה', 'סוכריות',
    'גלידה', 'ארטיק', 'מסטיק', 'פופקורן', 'אגוזים', 'שקדים',
    'בוטנים', 'צ\'יפס', 'קרמבו', 'עוגה', 'טורט',
  ],
  'שימורים ורטבים': [
    'שימורים', 'רסק', 'רוטב', 'קטשופ', 'מיונז', 'חרדל', 'סויה',
    'טחינה', 'חומוס', 'תירס', 'אפונה', 'שעועית', 'עדשים',
    'רוטב עגבניות', 'רוטב סויה', 'רוטב צ\'ילי',
  ],
  'תבלינים ושמנים': [
    'מלח', 'פלפל שחור', 'כורכום', 'פפריקה', 'קימון', 'קינמון',
    'אורגנו', 'בזיליקום', 'שמן זית', 'שמן קנולה', 'שמן', 'חומץ',
    'תבלין',
  ],
  'דגנים ואורז': [
    'אורז', 'פסטה', 'קוסקוס', 'בורגול', 'קינואה', 'שיבולת שועל',
    'קורנפלקס', 'גרנולה', 'חיטה', 'נודלס', 'ספגטי', 'פנה',
    'קמח', 'סוכר',
  ],
  'מוצרי ניקיון': [
    'סבון', 'שמפו', 'מרכך', 'אל סבון', 'נייר טואלט', 'מגבונים',
    'אקונומיקה', 'ספריי', 'נוזל כלים', 'נוזל כביסה', 'מרככ',
    'אבקת כביסה', 'מטלית', 'ספוג', 'שקיות זבל', 'שקיות אשפה',
    'כפפות', 'ניקוי',
  ],
  'טיפוח אישי': [
    'משחת שיניים', 'מברשת שיניים', 'דאודורנט', 'קרם', 'סבון פנים',
    'ג\'ל רחצה', 'תער', 'גילוח', 'מגבות', 'מברשת שיער',
  ],
  'מוצרים לתינוקות': [
    'חיתול', 'חיתולים', 'מטרנה', 'סימילק', 'מוצץ', 'בקבוק תינוק',
    'מגבונים לתינוק', 'דייסה',
  ],
  'מזון קפוא': [
    'קפוא', 'פיצה קפואה', 'שניצל קפוא', 'ירקות קפואים', 'בורקס קפוא',
    'נאגטס', 'שווארמה', 'פלאפל', 'ציפס', 'גלידה',
  ],
};

/** All available category names */
export const CATEGORY_NAMES = Object.keys(CATEGORY_KEYWORDS);

/**
 * Recommended default buy-cycle days per category.
 * Based on typical Israeli household consumption patterns.
 */
const CATEGORY_DEFAULT_DAYS: Record<string, number> = {
  'פירות וירקות': 4,
  'מוצרי חלב': 5,
  'בשר ועוף': 6,
  'דגים ופירות ים': 8,
  'לחם ומאפים': 3,
  'ביצים': 10,
  'משקאות': 7,
  'חטיפים ומתוקים': 10,
  'שימורים ורטבים': 30,
  'תבלינים ושמנים': 45,
  'דגנים ואורז': 18,
  'מוצרי ניקיון': 30,
  'טיפוח אישי': 30,
  'מוצרים לתינוקות': 14,
  'מזון קפוא': 14,
};

/**
 * Get smart default buy-cycle days based on detected category.
 * Falls back to 7 days if category is unknown.
 */
export function getSmartDefaultDays(category: string | null): number {
  if (!category) return 7;
  return CATEGORY_DEFAULT_DAYS[category] ?? 7;
}

/**
 * Detect category for a Hebrew product name.
 * Returns the best-matching category or null.
 */
export function detectCategory(productName: string): string | null {
  const name = productName.trim().toLowerCase();
  if (name.length < 2) return null;

  // Exact keyword match first
  for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
    for (const kw of keywords) {
      if (name === kw || name.includes(kw) || kw.includes(name)) {
        return category;
      }
    }
  }

  return null;
}

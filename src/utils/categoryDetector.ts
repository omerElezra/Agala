/**
 * Auto-detect product category from Hebrew product name.
 * Category structure matches Israeli supermarket departments
 * (Shufersal, Rami Levy, Mega, Yochananof, Victory).
 */

type CategoryMap = Record<string, string[]>;

// Hebrew keywords → category — extensive Israeli supermarket mapping
const CATEGORY_KEYWORDS: CategoryMap = {
  'פירות וירקות': [
    // ── פירות ──
    'תפוח', 'תפוחים', 'בננה', 'בננות', 'תפוז', 'תפוזים', 'לימון', 'לימונים',
    'אבוקדו', 'אבוקאדו', 'מנגו', 'ענבים', 'אפרסק', 'אפרסקים', 'נקטרינה',
    'שזיף', 'שזיפים', 'אגס', 'אגסים', 'קיווי', 'רימון', 'רימונים',
    'אננס', 'דובדבן', 'דובדבנים', 'תות', 'תותים', 'אבטיח', 'מלון',
    'פומלה', 'פומלו', 'קלמנטינה', 'קלמנטינות', 'גויאבה', 'פסיפלורה',
    'ליצ\'י', 'אוכמניות', 'פטל', 'חבוש', 'תמר', 'תמרים', 'צימוקים',
    'חמוציות', 'פירות יבשים', 'משמש', 'משמשים', 'סברס',
    // ── ירקות ──
    'עגבניה', 'עגבניות', 'עגבנייה', 'מלפפון', 'מלפפונים', 'פלפל', 'פלפלים',
    'בצל', 'בצלים', 'שום', 'גזר', 'גזרים', 'חסה', 'חסות',
    'כרוב', 'ברוקולי', 'כרובית', 'חציל', 'חצילים', 'קישוא', 'קישואים',
    'בטטה', 'בטטות', 'תפוח אדמה', 'תפו"א', 'תפוחי אדמה',
    'סלרי', 'כוסברה', 'פטרוזיליה', 'נענע', 'שמיר', 'בזיליקום טרי',
    'רוקולה', 'תרד', 'פטריות', 'שמפיניון', 'זיתים',
    'דלעת', 'צנונית', 'צנונ', 'לפת', 'ירקות', 'פירות', 'סלט',
    'שעועית ירוקה', 'אפונה טרייה', 'תירס טרי', 'קולורבי',
    'ארטישוק', 'אספרגוס', 'קייל', 'מנגולד', 'שומר', 'צנון',
    'כרשה', 'בצל ירוק', 'שאלוט', 'פלפל חריף', 'צ\'ילי',
    'ג\'ינג\'ר', 'זנגביל', 'עירית', 'חומוס גולמי',
    'עלי גפן', 'עלי בייבי', 'עשבי תיבול',
  ],
  'חלב וביצים': [
    // ── חלב ──
    'חלב', 'חלב טרי', 'חלב 1%', 'חלב 3%', 'חלב דל שומן',
    'חלב סויה', 'חלב שקדים', 'חלב שיבולת שועל', 'חלב קוקוס',
    // ── גבינות ──
    'גבינה', 'גבינה צהובה', 'גבינה לבנה', 'גבינת שמנת', 'גבינה בולגרית',
    'קוטג\'', 'קוטג', 'מוצרלה', 'פרמזן', 'גאודה', 'אמנטל', 'עמק',
    'קממבר', 'ברי', 'פטה', 'צפתית', 'ריקוטה', 'מסקרפונה',
    'גבינה מגורדת', 'גבינת עיזים', 'גבינת כבשים', 'לבנה',
    'גבינה נמסית', 'גבינה טבעונית',
    // ── יוגורט ומעדנים ──
    'יוגורט', 'יופלה', 'אקטיביה', 'דנונה', 'מעדן', 'מעדנים',
    'פודינג', 'מוס שוקולד', 'ג\'לי', 'מעדן חלב', 'דנונינו',
    // ── שמנת ──
    'שמנת', 'שמנת חמוצה', 'שמנת מתוקה', 'שמנת להקצפה',
    // ── חלביים אחרים ──
    'קפיר', 'לבן', 'מילקי', 'שוקו', 'שוקולד חלב',
    'חמאה', 'מרגרינה', 'טוסט', 'חלב מרוכז',
    // ── ביצים ──
    'ביצים', 'ביצה', 'ביצים חופש', 'ביצים אורגניות',
  ],
  'בשר, עוף ודגים': [
    // ── עוף ──
    'עוף', 'חזה עוף', 'שניצל', 'שניצלון', 'כרעיים', 'פרגית', 'פרגיות',
    'כנפיים', 'שוק עוף', 'שוקיים', 'עוף שלם', 'חזה הודו', 'הודו',
    'עוף טחון', 'קציצות עוף', 'נקניקיית עוף', 'שישליק עוף',
    // ── בקר ──
    'בשר', 'בשר טחון', 'סטייק', 'אנטריקוט', 'סינטה', 'פילה',
    'צלעות', 'אסאדו', 'שפונדרה', 'בקר', 'צוואר בקר', 'כתף בקר',
    'בורגר', 'המבורגר', 'קבב', 'קציצות', 'קפטה',
    // ── כבש ──
    'כבש', 'טלה', 'צלעות כבש', 'שוק כבש', 'כתף טלה',
    // ── נקניקים ──
    'נקניק', 'נקניקיה', 'נקניקיות', 'סלמי', 'פסטרמה', 'חזה הודו מעושן',
    'נקניק הודו', 'קבנוס', 'צ\'וריסו', 'מרגז',
    // ── בשר מוכן ──
    'שווארמה', 'שישליק', 'אנטריקוט מתובל',
    // ── דגים ──
    'דג', 'דגים', 'סלמון', 'סלמון טרי', 'סלמון מעושן', 'סלמון פילה',
    'טונה', 'טונה בשמן', 'טונה במים', 'אמנון', 'מוסר', 'בורי',
    'דניס', 'לוקוס', 'נסיכה', 'פילה דג', 'פילה דגים',
    'שרימפס', 'קלמרי', 'סרדין', 'סרדינים', 'מקרל', 'בקלה',
    'ברמונדי', 'לברק', 'פורל', 'נילוס', 'מושט', 'קרפיון',
    'דג מעושן', 'הרינג', 'אנשובי', 'סושי', 'סשימי',
    'רול סושי', 'סורימי', 'קרב סטיק',
    'דג טרי', 'דג קפוא', 'פילה ברמונדי',
  ],
  'לחם ומאפים': [
    // ── לחמים ──
    'לחם', 'לחם אחיד', 'לחם מלא', 'לחם שיפון', 'לחם כוסמין',
    'לחם דגנים', 'לחם אורגני', 'לחם קל', 'לחם פרוס',
    'חלה', 'חלות', 'פיתה', 'פיתות', 'טורטייה', 'לחמנייה', 'לחמניות',
    'באגט', 'צ\'יאבטה', 'פוקאצ\'ה', 'לאפה', 'לאפות',
    'לחם כפרי', 'לחם תנור', 'לחם שום',
    // ── מאפים ──
    'קרואסון', 'מאפה', 'מאפים', 'בורקס', 'בורקסים',
    'רוגלך', 'שמרית', 'דניש', 'בריוש', 'סופגנייה', 'סופגניות',
    'סינבון', 'מאפין', 'מאפינס',
    // ── ביסקוויטים ──
    'עוגייה', 'עוגיות', 'ביסקוויט', 'ביסקוויטים',
    'קרקר', 'קרקרים', 'פריכיות', 'פת', 'צנימים',
    'פריכיות אורז', 'מצות', 'מצה',
    // ── עוגות ──
    'עוגה', 'עוגת שוקולד', 'עוגת גבינה', 'טורט', 'רולדה',
    'עוגת שכבות', 'קרמשניט', 'פאי', 'טארט',
  ],
  'שתייה': [
    // ── מים ──
    'מים', 'מים מינרליים', 'מי עדן', 'נביעות', 'מי מעיין',
    'סודה', 'סודה סטרים', 'מים בטעם',
    // ── מיצים ──
    'מיץ', 'מיץ תפוזים', 'מיץ תפוחים', 'מיץ ענבים', 'מיץ גזר',
    'מיץ פרי', 'פריגת', 'ג\'מפ', 'ספרינג', 'חוויתא',
    // ── משקאות מוגזים ──
    'קולה', 'קוקה קולה', 'פפסי', 'ספרייט', 'פאנטה', 'שוופס',
    'RC קולה', 'דיאט קולה', 'זירו', 'טוניק', 'ג\'ינג\'ר',
    // ── משקאות אנרגיה ──
    'אנרגיה', 'רד בול', 'XL', 'באסטרד', 'מונסטר',
    // ── קפה ותה ──
    'קפה', 'נס קפה', 'נסקפה', 'עלית', 'אספרסו',
    'קפסולות', 'קפסולות קפה', 'נספרסו', 'דולצ\'ה גוסטו',
    'קפוצ\'ינו', 'תה', 'שקיקי תה', 'תה ירוק', 'תה צמחים',
    'ויסוצקי', 'טווינינגס', 'קקאו', 'שוקו חם',
    'קפה טורקי', 'קפה נמס', 'לנדוור',
    // ── לימונדה ──
    'לימונדה', 'אייס טי', 'פיוז טי',
  ],
  'יין ואלכוהול': [
    // ── בירה ──
    'בירה', 'גולדסטאר', 'מכבי', 'קרלסברג', 'הייניקן', 'טובורג',
    'בירה מלאכתית', 'אלכסנדר', 'נגב', 'מלכה', 'שפירא',
    // ── יין ──
    'יין', 'יין אדום', 'יין לבן', 'יין רוזה', 'יין מבעבע',
    'קאווה', 'פרוסקו', 'שמפניה', 'יקב', 'ברקן', 'רמת הגולן',
    'כרמל', 'יתיר', 'גולן', 'טפרברג',
    // ── משקאות חריפים ──
    'וודקה', 'ויסקי', 'ג\'ין', 'רום', 'ערק', 'טקילה', 'ליקר',
    'סיידר', 'אפרול', 'קמפרי', 'ברנדי', 'קוניאק',
    'אלכוהול', 'משקה חריף',
  ],
  'חטיפים, ממתקים ודגנים': [
    // ── שוקולד ──
    'שוקולד', 'שוקולד מריר', 'שוקולד חלב', 'שוקולד לבן',
    'פרה', 'מקור', 'וובלי', 'פסק זמן', 'קליק', 'קינדר',
    'פררו', 'לינדט', 'טובלרון', 'סניקרס', 'מארס', 'טוויקס',
    'אגוז טוב', 'שוקולד עלית', 'כיף כף',
    // ── חטיפים מלוחים ──
    'במבה', 'ביסלי', 'חטיף', 'צ\'יפס', 'שטראוס',
    'דוריטוס', 'לייס', 'פרינגלס', 'תפוצ\'יפס',
    'אפונה', 'קרמבו', 'טפוצ\'יפס',
    'פופקורן', 'בייגלה', 'פריצל', 'נקניקון',
    // ── סוכריות וגומי ──
    'סוכריה', 'סוכריות', 'מסטיק', 'טופי', 'גומי',
    'סוכריות גומי', 'מנטוס', 'סקיטלס', 'הריבו',
    // ── גלידה ──
    'גלידה', 'ארטיק', 'מגנום', 'קורנטו', 'בן אנד ג\'ריס',
    'גלידה בטעם', 'שלגון',
    // ── אגוזים ופיצוחים ──
    'אגוזים', 'שקדים', 'בוטנים', 'קשיו', 'פיסטוק', 'פקאן',
    'אגוזי לוז', 'אגוזי מלך', 'פיצוחים', 'גרעינים',
    'חמניות', 'גרעיני דלעת', 'מיקס אגוזים', 'טריל מיקס',
    // ── וופלים ועוגות ──
    'וופל', 'וופלים', 'עוגיות שוקולד', 'עוגיות חמאה', 'בראוני',
    // ── דגני בוקר ──
    'קורנפלקס', 'קורנפליקס', 'גרנולה', 'מיסלי',
    'כדורי שוקולד', 'דגני בוקר', 'פתיתי תירס',
    'שיבולת שועל', 'קוואקר', 'כרית שוקולד',
  ],
  'שימורים, רטבים וממרחים': [
    // ── שימורים ──
    'שימורים', 'תירס', 'תירס שימור', 'אפונה', 'אפונה שימור',
    'שעועית', 'שעועית לבנה', 'שעועית אדומה', 'עדשים',
    'חומוס שימור', 'גרגרי חומוס', 'פול', 'טונה בשימור',
    'זיתים שימור', 'מלפפון חמוץ', 'חמוצים', 'כרוב כבוש',
    'אנטיפסטי', 'פלפל קלוי', 'עגבניות מיובשות',
    // ── רטבים ──
    'רסק', 'רסק עגבניות', 'רוטב', 'רוטב עגבניות', 'רוטב פסטה',
    'רוטב פיצה', 'רוטב ברביקיו', 'רוטב טריאקי', 'רוטב צ\'ילי',
    'רוטב סויה', 'רוטב חריף', 'סחוג', 'הריסה',
    // ── ממרחים ──
    'קטשופ', 'מיונז', 'חרדל', 'טחינה', 'טחינה גולמית',
    'חומוס', 'חומוס מוכן', 'באבא גנוש', 'סלט חצילים',
    'ממרח', 'ממרח שוקולד', 'נוטלה', 'חמאת בוטנים',
    'ריבה', 'ריבת תות', 'ריבת משמש', 'דבש', 'סילאן',
    'תמרים ממרח', 'חלבה',
  ],
  'תבלינים, אפייה ושמנים': [
    // ── תבלינים ──
    'מלח', 'פלפל', 'פלפל שחור', 'כורכום', 'פפריקה', 'פפריקה מתוקה',
    'פפריקה חריפה', 'קימון', 'קינמון', 'ציפורן', 'כמון',
    'אורגנו', 'בזיליקום', 'רוזמרין', 'טימין', 'מרווה',
    'זעתר', 'סומק', 'גרעיני כוסברה', 'כוסבר', 'ג\'ינג\'ר טחון',
    'אגוז מוסקט', 'שום טחון', 'בצל טחון', 'פלפל לימון',
    'תבלין', 'תערובת תבלינים', 'בהרט', 'חוואיג\'', 'רס אל חנוט',
    'קארי', 'גראם מסאלה', 'צ\'ילי פלקס', 'סריראצ\'ה',
    'תבלין לעוף', 'תבלין לבשר', 'תבלין לדגים', 'תבלין למרק',
    'תבלין שוק', 'מיקס ירוקים',
    // ── שמנים וחומץ ──
    'שמן זית', 'שמן זית כתית', 'שמן קנולה', 'שמן חמניות',
    'שמן שומשום', 'שמן קוקוס', 'שמן אגוז', 'שמן',
    'חומץ', 'חומץ בלסמי', 'חומץ תפוחים', 'חומץ יין', 'חומץ לבן',
    'לימון מרוכז', 'מיץ לימון',
    // ── חומרי אפייה ──
    'קמח', 'קמח תופח', 'אבקת אפייה', 'שמרים', 'שמרי בירה',
    'סוכר', 'סוכר דק', 'סוכר חום', 'סוכר וניל',
    'תמצית וניל', 'וניל', 'אבקת קקאו',
    'שוקולד למאפים', 'שוקולד ציפס', 'שבבי שוקולד',
    'קרם לקצפת', 'קצפת מוכנה', 'קרם פטיסייר',
    'בצק פריך', 'בצק עלים', 'קישוטים לעוגה',
    'מרציפן', 'בצק סוכר', 'פונדנט',
    'סירופ', 'סירופ מייפל', 'סירופ שוקולד', 'סירופ פירות',
    'ג\'מי', 'קונפיטורה',
    'קמח לבן', 'קמח מלא', 'קמח כוסמין',
  ],
  'פסטה, אורז וקטניות': [
    // ── אורז ──
    'אורז', 'אורז לבן', 'אורז מלא', 'אורז בסמטי', 'אורז יסמין',
    'אורז סושי', 'אורז ארבוריו',
    // ── פסטה ──
    'פסטה', 'ספגטי', 'פנה', 'פוזילי', 'מקרוני', 'לזניה', 'רביולי',
    'טורטליני', 'כוסכוס', 'קוסקוס', 'פתיתים', 'אטריות',
    'נודלס', 'אידמי', 'סובה', 'אודון', 'גלאס נודלס',
    // ── קטניות ──
    'בורגול', 'קינואה', 'פריקה', 'גריסים', 'פולנטה',
    'חיטה', 'סוכרזית', 'סטיוויה',
    'עדשים', 'עדשים אדומות', 'עדשים ירוקות', 'עדשים שחורות',
    'שעועית יבשה', 'חומוס יבש', 'פול יבש', 'גרגרי חומוס',
    'שקדי מרק',
  ],
  'ניקיון וחד פעמי': [
    // ── ניקיון בית ──
    'סבון כלים', 'נוזל כלים', 'פיירי', 'נוזל ניקוי', 'נוזל רצפות',
    'אקונומיקה', 'ספריי', 'ספריי ניקוי', 'מר מוסקול',
    'ספריי שמנים', 'ספריי חלונות', 'ספריי אמבטיה',
    'נוזל כביסה', 'אבקת כביסה', 'כדורי כביסה', 'ג\'ל כביסה',
    'מרכך כביסה', 'מרככ', 'סנו', 'אריאל', 'פרסיל',
    'שקיות זבל', 'שקיות אשפה', 'שקיות זיפלוק',
    'מטלית', 'מטליות', 'ספוג', 'ספוגים', 'ספוג פלדה',
    'כפפות', 'כפפות ניטריל', 'טואלט', 'תרסיס',
    'ניקוי', 'מנקה', 'חומר ניקוי',
    // ── נייר ──
    'נייר טואלט', 'מגבות נייר', 'טישו', 'ממחטות', 'נייר סופג',
    'מגבונים', 'מגבונים לחים', 'מגבונים אנטיבקטריאלי',
    // ── חד פעמי ──
    'צלחות חד פעמי', 'כוסות חד פעמי', 'סכום חד פעמי',
    'מפיות', 'שקיות', 'רדיד אלומיניום', 'נייר אפייה',
    'ניילון נצמד', 'פוליאתילן',
    'חד פעמי', 'כלים חד פעמי',
  ],
  'טיפוח והיגיינה': [
    // ── רחצה ──
    'סבון', 'סבון ידיים', 'סבון גוף', 'אל סבון',
    'ג\'ל רחצה', 'שמפו', 'שמפו ומרכך', 'מרכך שיער', 'קונדישנר',
    'סבון פנים', 'ג\'ל ניקוי פנים',
    // ── שיניים ──
    'משחת שיניים', 'מברשת שיניים', 'מי פה', 'חוט דנטלי',
    'קיסמים',
    // ── דאו ובושם ──
    'דאודורנט', 'דאו', 'ספריי גוף', 'בושם',
    // ── טיפוח ──
    'קרם', 'קרם ידיים', 'קרם גוף', 'קרם פנים', 'קרם לחות',
    'קרם הגנה', 'סאנסקרין', 'לושן',
    'גילוח', 'תער', 'סכין גילוח', 'קצף גילוח', 'אפטרשייב',
    'מברשת שיער', 'מסרק', 'גומיות לשיער', 'סיכות שיער',
    'לק', 'תספורת', 'צבע שיער', 'מסכת שיער',
    // ── היגיינה ──
    'תחבושות', 'טמפונים', 'פדים', 'מגן תחתון',
    'מגבות', 'מגבת',
  ],
  'תינוקות': [
    'חיתול', 'חיתולים', 'האגיס', 'פמפרס', 'בייבי',
    'מטרנה', 'סימילק', 'תמ"ל', 'תחליף חלב אם',
    'מוצץ', 'בקבוק תינוק', 'בקבוק האכלה',
    'מגבונים לתינוק', 'מגבוני בייבי',
    'דייסה', 'דייסת אורז', 'דייסת קמח', 'מחית',
    'מחית פירות', 'מחית ירקות', 'מזון תינוקות',
    'שמפו לתינוק', 'סבון לתינוק', 'קרם החתלה',
    'ביבים', 'ביב', 'כוס מעבר',
    'תינוק', 'לתינוק',
  ],
  'קפואים': [
    'קפוא', 'פיצה קפואה', 'פיצה', 'שניצל קפוא',
    'ירקות קפואים', 'ירקות מוקפאים', 'תירס קפוא',
    'בורקס קפוא', 'בצק עלים', 'בצק פילו',
    'נאגטס', 'נאגטס עוף', 'שניצלונים', 'פינגרס',
    'שווארמה קפואה', 'פלאפל', 'פלאפל קפוא',
    'ציפס', 'צ\'יפס קפוא', 'תפוחי אדמה קפואים',
    'פירות קפואים', 'תותים קפואים', 'אוכמניות קפואות',
    'שרימפס קפוא', 'בורגר קפוא',
    'לזניה קפואה', 'ספרינג רולס', 'דים סאם',
    'בצק פיצה', 'מאפים קפואים',
    'קפוא', 'מוקפא',
  ],
  'בריאות ואורגני': [
    'אורגני', 'טבעוני', 'ויגן', 'ללא גלוטן', 'גלוטן פרי',
    'טופו', 'טמפה', 'סויה', 'חלבון צמחי',
    'חלב צמחי', 'גבינה טבעונית', 'שמנת טבעונית',
    'המבורגר טבעוני', 'שניצל טבעוני', 'נקניק טבעוני',
    'ביונד מיט', 'אימפוסיבל',
    'סופרפוד', 'צ\'יה', 'זרעי צ\'יה', 'פשתן', 'זרעי פשתן',
    'ספירולינה', 'מאקה', 'אשוגנדה',
    'חלבון', 'אבקת חלבון', 'שייק חלבון',
    'גרעיני המפ', 'שמן המפ',
    'כורכום כמוסות', 'ויטמין', 'תוסף תזונה',
    'קמח שקדים', 'קמח קוקוס', 'סוכר קוקוס',
    'ממתיק טבעי', 'סטיוויה', 'אריתריטול',
    'פסטה מקמח עדשים', 'פסטה ירקות',
  ],
  'ארוחות מוכנות': [
    'חומוס מוכן', 'פלאפל מוכן', 'סלט מוכן',
    'ממרח חצילים', 'טאבולה', 'קוסקוס מוכן',
    'סושי מוכן', 'סנדוויץ\'', 'לפיתן', 'ראפ',
    'סלט ביצים', 'סלט טונה', 'סלט חצילים',
    'מרק מוכן', 'מרק', 'מרק עוף', 'מרק ירקות', 'מרק עדשים',
    'שקדי מרק', 'קרוטונים', 'אבקת מרק', 'קוביות מרק',
    'נובי', 'פתיתים מוכנים',
    'אורז מוכן', 'אוכל מוכן',
  ],
};

/** All available category names */
export const CATEGORY_NAMES = Object.keys(CATEGORY_KEYWORDS);

/**
 * Recommended default buy-cycle days per category.
 * Based on typical Israeli household consumption patterns.
 */
const CATEGORY_DEFAULT_DAYS: Record<string, number> = {
  'פירות וירקות': 4,
  'חלב וביצים': 5,
  'בשר, עוף ודגים': 6,
  'לחם ומאפים': 3,
  'שתייה': 7,
  'יין ואלכוהול': 21,
  'חטיפים, ממתקים ודגנים': 10,
  'שימורים, רטבים וממרחים': 30,
  'תבלינים, אפייה ושמנים': 45,
  'פסטה, אורז וקטניות': 18,
  'ניקיון וחד פעמי': 30,
  'טיפוח והיגיינה': 30,
  'תינוקות': 14,
  'קפואים': 14,
  'בריאות ואורגני': 14,
  'ארוחות מוכנות': 5,
};

/**
 * Get smart default buy-cycle days based on detected category.
 * Falls back to 7 days if category is unknown.
 */
export function getSmartDefaultDays(category: string | null): number {
  if (!category) return 7;
  return CATEGORY_DEFAULT_DAYS[category] ?? 7;
}

/**
 * Detect category for a Hebrew product name.
 * Returns the best-matching category or null.
 */
export function detectCategory(productName: string): string | null {
  const name = productName.trim().toLowerCase();
  if (name.length < 2) return null;

  // Exact keyword match first
  for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
    for (const kw of keywords) {
      if (name === kw || name.includes(kw) || kw.includes(name)) {
        return category;
      }
    }
  }

  return null;
}
